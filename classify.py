import pandas as pd

# 讀入你手動整理後的資料
df = pd.read_csv("classified_data.csv")

# 定義副分類函式（針對 restaurant_types 欄位）
def classify_subcategory(text):
    text = str(text).lower()

    if any(k in text for k in [
        "中式","中國料理","中國菜","中餐廳","中華料理","川菜","湘菜","粵菜","廣東菜","江浙菜","上海菜","北京烤鴨","麻辣火鍋","老火湯","煲仔飯","燒臘","餃子","小籠包","炒飯","炒麵","鹹水雞","滷味","湯麵","麻婆豆腐","東坡肉","糖醋排骨"]):
        return '中式'
    if any(k in text for k in [
        "台式","台灣料理","台灣菜","台灣小吃","台灣餐廳","滷肉飯","鹽酥雞","蚵仔煎","肉圓","大腸包小腸","魯肉飯","豬腳飯","米糕","魚丸湯","擔仔麵","鹹酥雞","花枝羹","台灣火鍋","黑輪","肉燥飯","火鍋","小吃"]):
        return '台式'
    if any(k in text for k in [
        "韓式","韓國料理","韓國","韓國菜","韓國餐廳","韓食","韓國烤肉","韓式烤肉","韓國炸雞","韓式炸雞","部隊鍋","石鍋拌飯","韓式拌飯","拌飯","泡菜鍋","韓式鍋物","韓式湯品","辣炒年糕","韓式小吃","韓國小吃","銅盤烤肉","韓國火鍋","韓國豆腐鍋","韓式便當"]):
        return '韓式'
    if any(k in text for k in [
        "日式","日本料理","日本菜","日本餐廳","日式料理","壽司","生魚片","刺身","握壽司","炙燒壽司","手卷","定食","拉麵","拉面","烏龍麵","蕎麥麵","親子丼","豬排飯","炸豬排","日式便當","丼飯","鰻魚飯","天婦羅","味噌湯","關東煮","居酒屋","燒鳥","日式火鍋"]):
        return '日式'
    if any(k in text for k in [
        "泰式","泰國料理","泰國菜","泰國餐廳","泰式料理","泰菜","泰國","打拋豬","打拋雞","綠咖哩","紅咖哩","黃咖哩","泰式涼拌","涼拌木瓜","涼拌海鮮","月亮蝦餅","泰式酸辣湯","冬蔭功","椰奶雞湯","椒麻雞","泰國米粉","泰式炒河粉","泰式火鍋","泰式便當"]):
        return '泰式'
    if any(k in text for k in [
        "美式","美國料理","美國菜","美式料理","美式餐廳","美式漢堡","漢堡","起司漢堡","炸雞","美式炸雞","烤雞","美式早餐","牛排","美式牛排","豬肋排","烤肋排","熱狗","薯條","薯餅","炸物拼盤","BBQ","墨西哥捲餅","美式沙拉","炸洋蔥圈",]):
        return '美式'
    if any(k in text for k in [
        "義式","義大利料理","義大利菜","義式餐廳","義式料理","義大利麵","義大利面","披薩","比薩","薄餅","燉飯","義式燉飯","提拉米蘇","青醬","白醬","番茄義大利麵","青醬義大利麵","白醬義大利麵","千層麵","義式濃湯","羅勒","帕瑪森起司"]):
        return '義式'
    if any(k in text for k in [
        "越式","越南料理","越南菜","越南餐廳","越式料理","越南河粉","河粉","牛肉河粉","越南春捲","炸春捲","越南咖啡","法包","越南法包","牛肉捲餅","越南米線","越南湯麵","涼拌青木瓜","越南炸雞","越式沙拉"]):
        return '越式'
    
    return '其他'

# 新增 sub_category 欄位：只針對正餐類 category_code == 0
df['sub_category'] = df.apply(
    lambda row: classify_subcategory(row['restaurant_types']) if row['meal_type'] == 0 else '',
    axis=1
)

# 輸出成新檔案
df.to_csv("classified_restaurants_with_subcategory.csv", index=False)
print("✅ 已輸出：classified_restaurants_with_subcategory.csv")
print(df.columns)
